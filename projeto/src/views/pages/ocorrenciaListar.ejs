
<%- include ('../layouts/header') %>

<div class="row">
        
        <!-- Minhas Ocorrências -->
        <div class="col-md-12 mb-4" id="divCardsOcorrencia">
            <div class="card card-ocorrencia">
                <div class="card-header card-header-ocorrencia d-flex justify-content-between align-items-center" >
                    <h5 class="card-title mb-0">Ocorrências Atendimento</h5>
                    <a class="card-link ml-auto" data-toggle="collapse" href="#divCardOcorrenciaMinhas"><i class="fa-solid fa-chevron-up fa-lg" style="color:white"></i></a>
                </div>
                <div id="divCardOcorrenciaMinhas" class="collapse show" data-parent="#divCardsOcorrencia">
                    <div class="card-body">

                        <table class="table table-striped">
                            <thead>
                            <tr>
                                <th scope="col">Ocorrência</th>
                                <th scope="col">Responsável</th>
                                <th scope="col">Data</th>
                                <th scope="col">Situação</th>
                                <th scope="col">Ações</th>
                            </tr>
                            </thead>
                            <tbody>

                                <% 
                                    let idOcorrencia;
                                    ocorrenciasMinhas.forEach(ocorrencia => { 

                                        if (idOcorrencia != ocorrencia.idOcorrencia) {
                                            
                                            const ocorrenciasResponsavelList_Filtrado = ocorrenciasMinhas.filter(ocorrenciaFilter => ocorrenciaFilter.idOcorrencia === ocorrencia.idOcorrencia);
                                            let blocoHtmlResponsavel = "";
                                            
                                            ocorrenciasResponsavelList_Filtrado.forEach(ocorrenciaResponsavel => { 
                                                
                                                if (ocorrenciaResponsavel.nmPessoaResponsavel != null && ocorrenciaResponsavel.nmPessoaResponsavel  != "")
                                                    blocoHtmlResponsavel += '<i class=\"fa-solid fa-user fa-lg\"></i>&nbsp;&nbsp;&nbsp;' + ocorrenciaResponsavel.nmPessoaResponsavel + '  ' + ocorrenciaResponsavel.idOcorrencia + '<br>';
                                                
                                                if (ocorrenciaResponsavel.nmPessoaResponsavelCoordenador != null && ocorrenciaResponsavel.nmPessoaResponsavelCoordenador  != "")
                                                    blocoHtmlResponsavel += '<i class=\"fa-solid fa-chalkboard-user fa-lg\"></i>&nbsp;&nbsp;&nbsp;' + ocorrenciaResponsavel.nmPessoaResponsavelCoordenador   + '  ' + ocorrenciaResponsavel.idOcorrencia + '<br>';
                                                
                                                    if (ocorrenciaResponsavel.nmPerfilResponsavel != null && ocorrenciaResponsavel.nmPerfilResponsavel  != "")
                                                    blocoHtmlResponsavel += '<i class=\"fa-solid fa-people-group fa-lg\"></i>&nbsp;' + ocorrenciaResponsavel.nmPerfilResponsavel + '  ' + ocorrenciaResponsavel.idOcorrencia + '<br>';
                                            });
                                %>
                                            <tr>
                                                <td><%= ocorrencia.deOcorrencia %></td>
                                                
                                                <td>
                                                    <%- blocoHtmlResponsavel %>
                                                </td>
                                                <td>
                                                    <%= formataData(ocorrencia.dtOcorrencia) %>
                                                </td>

                                                <td><%= ocorrencia.deOcorrenciaSituacao %></td>
                                                <td><i class="fa-solid fa-pen-to-square fa-lg"></i> &nbsp;&nbsp; <i class="fa-solid fa-trash fa-lg"></i></i></td>
                                            </tr>
                                <%
                                         }
                                         
                                         idOcorrencia = ocorrencia.idOcorrencia;
                                    });

                                %>  
                            
                            </tbody>
                        </table>
                    </div>
                    <div class="card-footer">
                        <button type="button" id="btnOcorrenciaIncluirInit" class="btn card-header-ocorrencia hover:bg-fuchsia-700"><i class="fa-solid fa-plus"></i> incluir</button>
                    </div>
                </div>
            </div>
        </div>
        
        
         <!-- Ocorrências Minha Responsabilidade -->
         <div class="col-md-12 mb-4" id="divCardsOcorrenciaR">
            <div class="card card-ocorrencia" >
                <div class="card-header card-header-ocorrencia d-flex justify-content-between align-items-center" >
                    <h5 class="card-title mb-0">Ocorrências Minhas Responsabilidade</h5>
                    <a class="card-link ml-auto" data-toggle="collapse" href="#divCardOcorrenciaResponsabel"><i class="fa-solid fa-chevron-up fa-lg" style="color:white"></i></a>
                </div>
                <div id="divCardOcorrenciaResponsabel" class="collapse show" data-parent="#divCardsOcorrenciaR">
                    <div class="card-body">

                        <table class="table table-striped">
                            <thead>
                            <tr>
                                <th scope="col">Ocorrência</th>
                                <th scope="col">Solicitante</th>
                                <th scope="col">Data</th>
                                <th scope="col">Situação</th>
                                <th scope="col">Ações</th>
                            </tr>
                            </thead>
                            <tbody>

                                <% 
                                idOcorrencia = 0;
                                ocorrenciasMinhaResponsabilidade.forEach(ocorrencia => { 

                                    if (idOcorrencia != ocorrencia.idOcorrencia) {
                                %>
                                        <tr>
                                            <td><%= ocorrencia.deOcorrencia %></td>
                                            
                                            <td>
                                                <%= ocorrencia.nmPessoa %>
                                            </td>
                                            <td>
                                                <%= formataData(ocorrencia.dtOcorrencia) %>
                                            </td>

                                            <td><%= ocorrencia.deOcorrenciaSituacao %></td>
                                            <td> <i class="fa-solid fa-pen-to-square fa-lg"></i> &nbsp;&nbsp; <i class="fa-solid fa-trash fa-lg"></i></i></td>
                                        </tr>
                            <%
                                     }
                                     
                                     idOcorrencia = ocorrencia.idOcorrencia;
                                });

                            %>  
                            </tbody>
                        </table>

                    </div>
                </div>    
            </div>
        </div>
    </div>
   
    <script src="/javascript/ocorrenciaListar_javaScript.js"></script>

<%- include ('../layouts/footer') %>